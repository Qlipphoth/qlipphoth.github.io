<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Qliphoth's Blog</title><meta name="author" content="Qliphoth"><meta name="copyright" content="Qliphoth"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="See You Next Game">
<meta property="og:type" content="website">
<meta property="og:title" content="Qliphoth&#39;s Blog">
<meta property="og:url" content="https://qlipphoth.github.io/index.html">
<meta property="og:site_name" content="Qliphoth&#39;s Blog">
<meta property="og:description" content="See You Next Game">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2023/08/12/NkcT1PLmZVj5iY3.png">
<meta property="article:author" content="Qliphoth">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/08/12/NkcT1PLmZVj5iY3.png"><link rel="shortcut icon" href="https://s2.loli.net/2023/08/12/NkcT1PLmZVj5iY3.png"><link rel="canonical" href="https://qlipphoth.github.io/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":500,"languages":{"author":"Author: Qliphoth","link":"Link: ","source":"Source: Qliphoth's Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Qliphoth\'s Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2025-01-14 10:21:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 10 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom/beauty.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.css"><link rel="stylesheet" href="/css/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2023/08/12/NkcT1PLmZVj5iY3.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">131</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">22</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw fas fa-comment-dots"></i><span> Talk</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw far fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://s2.loli.net/2023/08/14/GmrqfMSTWaYE7t1.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Qliphoth's Blog"><span class="site-name">Qliphoth's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw fas fa-comment-dots"></i><span> Talk</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw far fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Qliphoth's Blog</h1><div id="site-subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/qlipphoth" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://space.bilibili.com/33030427" target="_blank" title="Bilibili"><i class="fab fa-bilibili" style="color: #FB7299;"></i></a><a class="social-icon" href="mailto:1841362281@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2023/08/19/2023-8-19-1/" title="从零开始的 STL 实现记录"><img class="post-bg" src="https://s2.loli.net/2023/08/18/cDqb7yXhnK6rkpN.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="从零开始的 STL 实现记录"></a></div><div class="recent-post-info"><a class="article-title" href="/2023/08/19/2023-8-19-1/" title="从零开始的 STL 实现记录">从零开始的 STL 实现记录</a><div class="article-meta-wrap"><span class="article-meta"><i class="fas fa-thumbtack sticky"></i><span class="sticky">Sticky</span><span class="article-meta-separator">|</span></span><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-08-19T22:37:14.000Z" title="Created 2023-08-19 22:37:14">2023-08-19</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Cpp/">Cpp</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Cpp/STL/">STL</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Cpp/">Cpp</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/STL/">STL</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2023/08/19/2023-8-19-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
从上个月的四号创建 TinySTL以来已经过了一个多月，中间还准备了一场面试放了暑假，鸽了很久。但总之这个亲手实现基本 SGI-STL 的项目终于要完成了！
项目链接：https://github.com/Qlipphoth/TinySTL


在实现 STL 的过程中，我对 C++ 的语法与模板的使用有了更深入的理解，和一个月前确实不可同日而语，只能说 STL 不愧是被称为任何 C++ 初学者都得手搓一两遍的项目。为了加深自己的理解与印象，博主会陆续将 STL 的实现过程与笔记都整理至博客中，方便自己回顾的同时也希望能帮助到后续想要或正在实现 STL 的读者们。
STL 中有六大组件：

Allocator  (空间配置器)
Iterator   (迭代器)
Container  (容器)
Alogorithm (算法)
Functor    (仿函数)
Adapter    (适配器)

六大组件的相互套用，成就了 STL 强大的功能。值得注意的是，虽然六大组件看似独立，但在实际实现某一组件的过程中，往往会涉及到其他组件的相关内容，如迭代器中的一些操作就使用了算法组件中的一些 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/08/05/2024-8-5-1/" title="UGUI 源码解析"><img class="post-bg" src="https://s2.loli.net/2024/07/14/2wNJafA1kFbesZy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="UGUI 源码解析"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/08/05/2024-8-5-1/" title="UGUI 源码解析">UGUI 源码解析</a><div class="article-meta-wrap"><span class="article-meta"><i class="fas fa-thumbtack sticky"></i><span class="sticky">Sticky</span><span class="article-meta-separator">|</span></span><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-08-05T12:25:27.000Z" title="Created 2024-08-05 12:25:27">2024-08-05</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Unity/">Unity</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Unity/UGUI/">UGUI</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Unity/">Unity</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/C/">C#</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/UGUI/">UGUI</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/08/05/2024-8-5-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
Unity UI(UGUI) 是一套基于 GameObject 的 UI 系统，提供了从事件检测到渲染再到用户交互的完整功能。基于 UGUI 系统，我们可以快速构建出一个完整的 UI 界面。虽然 UGUI 使用简单，但是作为一名有追求的游戏开发者，我们不能只停留在使用的层面，更应该深入了解其原理，这样才能更好的根据需求优化甚至扩展 UGUI。
本系列文章将深入 UGUI 底层，从源码角度解析 UGUI 的实现原理，帮助大家建立起对 UGUI 的更深刻理解。
参考资料


本系列文章使用的 UGUI 源码来自于 Unity 官方的开源版本代码：https://github.com/Unity-Technologies/uGUI


由于该开源版本的 UGUI 源码较为老旧，许多功能与新版本 Unity 中所展示的并不一致。因此建议大家使用早期的 Unity 版本进行实验与学习，如 Unity 2019.4.1f1。


Unity 官方提供了许多文档与教程：

UGUI: https://docs.unity.cn/Packages/com.unity.ugui@1.0/manua ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/12/10/2024-12-10-1/" title="TortoiseSVN 简单入门"><img class="post-bg" src="https://s2.loli.net/2023/08/14/mkTFOD8fJbu4VH3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TortoiseSVN 简单入门"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/12/10/2024-12-10-1/" title="TortoiseSVN 简单入门">TortoiseSVN 简单入门</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-12-10T17:21:06.000Z" title="Created 2024-12-10 17:21:06">2024-12-10</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/MISC/">MISC</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/MISC/GameDev/">GameDev</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/GameDev/">GameDev</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/12/10/2024-12-10-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
Subversion(SVN) 是一个开源的版本控制系統, TortoiseSVN 是 Subversion 版本控制系统的一个免费开源客户端, 适用于 Windows 操作系统。TortoiseSVN 提供了一个用户友好的界面, 使得用户可以方便地访问 Subversion 版本控制系统，本文将简要介绍 TortoiseSVN 的使用。
TortoiseSVN 的使用
安装
下载地址: https://tortoisesvn.net/downloads.html, 页面里有语言包补丁的下载链接。

这里要注意安装时一定要勾选 command line client tools，这样才能在命令行中使用 svn 命令，以及启动服务端。
创建 SVN 仓库
一般在使用 SVN 时都会有一个远程的服务器，通过服务器的 URL 就可以 Check Out 仓库，这里为了演示方便，我们在本地创建一个 SVN 仓库充当远程服务器：

这里我们将 RemoteRepo 作为远程仓库，LocalRepo 作为本地仓库。
在 RemoteRepo 目录下右键，选择 TortoiseSVN -&gt ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/11/23/2024-11-23-1/" title="Lua 源码解析（二）：基本数据类型 —— 表（下）"><img class="post-bg" src="https://s2.loli.net/2024/11/08/NRtroieCAd98Uzp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lua 源码解析（二）：基本数据类型 —— 表（下）"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/11/23/2024-11-23-1/" title="Lua 源码解析（二）：基本数据类型 —— 表（下）">Lua 源码解析（二）：基本数据类型 —— 表（下）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-11-23T16:58:19.000Z" title="Created 2024-11-23 16:58:19">2024-11-23</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Lua/">Lua</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Lua/">Lua</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/11/23/2024-11-23-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
在 上一篇文章 中我们探讨了 Lua 中表的基本结构，以及表的创建、访问及插入元素等操作。但 Lua 中的表还有一个非常重要的特性：元表（metatable）。元表是 Lua 中表的一个重要特性，它可以让我们对表进行一些特殊的操作，比如重载表的操作符、修改表的行为等。我们甚至可以利用元表来实现面向对象编程。本文将继续探讨 Lua 中表的元表。
元表与元方法
每个值都可以有 元表（metatable）（注意，是所有）。元表 是定义了原始数据在某些事件下行为的一个普通Lua表。你可以通过设置其元表的某些特定属性来改变某个值的某些行为。举个例子，一个非数字值进行加法操作时，Lua会在这个值的元表中查找__add属性函数，找到了的情况下，Lua就会调用这个函数来执行加法操作：
1234567891011mt = &#123;&#125;mt.__add = function (a, b)    return a.a + b.aenda = &#123;a = 1&#125;b = &#123;a = 2&#125;setmetatable(a, mt)setmetatable(b, mt ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/11/17/2024-11-17-1/" title="Lua 源码解析（二）：基本数据类型 —— 表（上）"><img class="post-bg" src="https://s2.loli.net/2024/11/08/NRtroieCAd98Uzp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lua 源码解析（二）：基本数据类型 —— 表（上）"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/11/17/2024-11-17-1/" title="Lua 源码解析（二）：基本数据类型 —— 表（上）">Lua 源码解析（二）：基本数据类型 —— 表（上）</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-11-17T16:36:15.000Z" title="Created 2024-11-17 16:36:15">2024-11-17</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Lua/">Lua</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Lua/">Lua</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/11/17/2024-11-17-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
使用表来统一表示 Lua 中的一切数据，是Lua区分于其他语言的一个特色。这个特色从最开始的Lua版本保持至今，很大的原因是为了在设计上保持简洁。Lua 表分为数组和散列表部分，其中数组部分不像其他语言那样，从0开始作为第一个索引，而是从1开始。散列表部分可以存储任何其他不能存放在数组部分的数据，唯一的要求就是键值不能为nil。尽管内部实现上区分了这两个部分，但是对使用者而言却是透明的。使用Lua表，可以模拟出其他各种数据结构——数组、链表、树等。
table 的结构
表的节点以及表本身的结构均定义在 lobject.h 中：
12345678910111213141516/*** Nodes for Hash tables: A pack of two TValue&#x27;s (key-value pairs)** plus a &#x27;next&#x27; field to link colliding entries. The distribution** of the key&#x27;s fields (&#x27;key_tt&#x27; and &#x27; ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/11/15/2024-11-15-1/" title="Lua 源码解析（二）：基本数据类型 —— 字符串"><img class="post-bg" src="https://s2.loli.net/2024/11/08/NRtroieCAd98Uzp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lua 源码解析（二）：基本数据类型 —— 字符串"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/11/15/2024-11-15-1/" title="Lua 源码解析（二）：基本数据类型 —— 字符串">Lua 源码解析（二）：基本数据类型 —— 字符串</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-11-15T16:09:05.000Z" title="Created 2024-11-15 16:09:05">2024-11-15</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Lua/">Lua</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Lua/">Lua</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/11/15/2024-11-15-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
Lua 中共有两种字符串的变体类型，分别是短字符串和长字符串。在 Lua 中，字符串是一种不可变的数据类型，即一旦创建，就不能再被修改。因此，Lua 会维护一个字符串池，在创建字符串之前会先检查字符串是否已经存在，如果存在则直接返回，否则创建一个新的字符串。为此 Lua 会对字符串做很多额外的工作，如计算它们的哈希值，初始化字符串池等等。我们将在本文中详细讨论这些内容。
String 的定义
在 Lua 中的数据类型 中我们介绍了 Lua 中字符串的类型定义：
12345678/* Variant tags for strings */#define LUA_VSHRSTR	makevariant(LUA_TSTRING, 0)  /* short strings */#define LUA_VLNGSTR	makevariant(LUA_TSTRING, 1)  /* long strings */#define setsvalue(L,obj,x) \  &#123; TValue *io = (obj); TString *x_ = (x); \    val_(io).g ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/11/14/2024-11-14-1/" title="Lua 源码解析（二）：基本数据类型 —— Lua 中的数据类型"><img class="post-bg" src="https://s2.loli.net/2024/11/08/NRtroieCAd98Uzp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lua 源码解析（二）：基本数据类型 —— Lua 中的数据类型"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/11/14/2024-11-14-1/" title="Lua 源码解析（二）：基本数据类型 —— Lua 中的数据类型">Lua 源码解析（二）：基本数据类型 —— Lua 中的数据类型</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-11-14T15:28:37.000Z" title="Created 2024-11-14 15:28:37">2024-11-14</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Lua/">Lua</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Lua/">Lua</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/11/14/2024-11-14-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
本节开始，我们将分析 Lua 中各种数据类型的定义与实现。众所周知，Lua 是一种动态弱类型语言，在使用时我们不需要显式地声明变量的类型，而是由 Lua 运行时根据变量的值自动推断其类型。
所谓动态弱类型语言，是指在运行时才确定变量的类型，而且变量的类型可以随时改变。这种特性使得 Lua 在编程时更加灵活，但也增加了一些运行时的开销。为了达到动态类型效果，Lua 需要在内部维护一些数据结构来表示不同的数据类型。本节我们将从 Lua 中的类型定义开始，逐步分析 Lua 中的基本数据类型。

本文基于 Lua 5.4 版本源码进行分析。

Lua 中的类型定义
Lua 中一些比较重要的宏被放在了 lua.h 中，其中就包括了 Lua 中的数据类型定义。我们可以在 lua.h 中找到如下的定义：
12345678910111213141516/*** basic types*/#define LUA_TNONE		(-1)#define LUA_TNIL		0#define LUA_TBOOLEAN		1#define LUA_TLIGHTUSERDATA	2#define LUA_T ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/11/03/2024-11-3-1/" title="UGUI 番外之合批"><img class="post-bg" src="https://s2.loli.net/2024/07/14/2wNJafA1kFbesZy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="UGUI 番外之合批"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/11/03/2024-11-3-1/" title="UGUI 番外之合批">UGUI 番外之合批</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-11-03T21:01:21.000Z" title="Created 2024-11-03 21:01:21">2024-11-03</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Unity/">Unity</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Unity/UGUI/">UGUI</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Unity/">Unity</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/C/">C#</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/UGUI/">UGUI</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/11/03/2024-11-3-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">
Refs:
Unity3D UGUI系列之合批
UGUI学习 - 合批规则
UGUI合批源码分析及优化

前言
无论是我们的日常开发还是面试，UI 的合批永远是一个绕不开的话题。本文将分析 UGUI 中的合批机制，力图帮助大家以及笔者自己彻底搞清楚这一重要的概念。
批处理
批处理是渲染中常用的一种优化手段，它的核心思想是将多个绘制操作合并为一个绘制操作，从而减少 CPU 与 GPU 之间的通信次数（即 Draw Call），提高渲染效率。
在介绍批处理之前我们先看看一个普通的3D模型是怎么渲染出来的（详见 图形学补完计划（二）：Rendering Pipeline）：


CPU 准备好这个模型的网格、用到的贴图和Shader，然后 GPU 将网格、贴图、Shader加载到显存里面。


CPU 设置渲染状态。所谓设置渲染状态，就是 CPU 设置渲染网格时需要使用的使用的Shader，贴图等信息。


CPU 设置完毕渲染状态后，向 GPU 发出渲染的指令，然后GPU才开始按照 2 中设置的 Shader 和贴图真正渲染这个模型，并把渲染后的结果层递到屏幕上。CPU 向 GPU 发出 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/10/25/2024-10-25-2/" title="Unity 补完计划（四）：UGUI-16：Dropdown"><img class="post-bg" src="https://s2.loli.net/2024/07/14/2wNJafA1kFbesZy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity 补完计划（四）：UGUI-16：Dropdown"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/25/2024-10-25-2/" title="Unity 补完计划（四）：UGUI-16：Dropdown">Unity 补完计划（四）：UGUI-16：Dropdown</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-10-25T20:00:15.000Z" title="Created 2024-10-25 20:00:15">2024-10-25</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Unity/">Unity</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Unity/UGUI/">UGUI</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Unity/">Unity</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/C/">C#</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/10/25/2024-10-25-2/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言

本节我们将分析 UGUI 中的最后一个组件：Dropdown。Dropdown 意为下拉菜单，由多个我们之前分析过的 UI 组件共同组成，如 Button、Toggle、ScrollRect 等。Dropdown 是一个非常常用的 UI 组件，我们可以用它来实现下拉菜单、选项卡等功能。
Dropdown
Dropdown 的属性
在场景中新建一个 Dropdown 组件，可以看到其组成如下：

其中，Label 即代表显示在 Dropdown 主界面上的文本，Arrow 代表下拉箭头。Template 是一个比较特殊的对象，他是一个预制好的下拉列表模板，当点击 Dropdown 时，会根据此模板生成对应的下拉列表。
Template 本身是一个 ScrollRect，Item 即为下拉列表中的每个选项。
再来查看 Dropdown 的属性：

其中 Template 即为上面提到的下拉列表模板，Caption Text 与 Caption Image 分别代表 Dropdown 主界面上的文本和图片，而 Item Text 与 Item Image 则代表每个选项的文本与图片。 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/10/25/2024-10-25-1/" title="Unity 补完计划（四）：UGUI-15：ScrollBar &amp; ScrollRect"><img class="post-bg" src="https://s2.loli.net/2024/07/14/2wNJafA1kFbesZy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity 补完计划（四）：UGUI-15：ScrollBar &amp; ScrollRect"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/25/2024-10-25-1/" title="Unity 补完计划（四）：UGUI-15：ScrollBar &amp; ScrollRect">Unity 补完计划（四）：UGUI-15：ScrollBar &amp; ScrollRect</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-10-25T11:37:03.000Z" title="Created 2024-10-25 11:37:03">2024-10-25</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Unity/">Unity</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Unity/UGUI/">UGUI</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Unity/">Unity</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/C/">C#</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/10/25/2024-10-25-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
ScrollBar 和 ScrollRect 通常配合使用以实现滚动视图。ScrollBar 用于控制 ScrollRect 的滚动位置，而 ScrollRect 用于显示滚动内容。本文将介绍这两个组件的实现。

ScrollBar

ScrollBar 的作用实际上与 Slider 十分类似，代码的实现也大同小异。但就使用上的区别而言，Slider 主要用于数值的调整，而 ScrollBar 则大部分情况下用于滚动条。
ScrollBar 的属性

ScrollBar 的属性与 Slider 的属性基本一致，都有一个 OnValueChanged 事件，用于监听值的变化。不同之处在于 Slider 除了 HandleRect 之外还有一个 FillRect 用于填充的显示，而 ScrollBar 只有 HandleRect。
ScrollBar 的交互
ScrollBar 也实现了 OnXXXDrag 系列事件以及 OnPointerXXX 系列事件，用于处理拖拽以及点击的交互。
拖拽类事件
1234567891011121314151617181920212223242526 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/10/23/2024-10-23-1/" title="Unity 补完计划（四）：UGUI-14：InputField"><img class="post-bg" src="https://s2.loli.net/2024/07/14/2wNJafA1kFbesZy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity 补完计划（四）：UGUI-14：InputField"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/23/2024-10-23-1/" title="Unity 补完计划（四）：UGUI-14：InputField">Unity 补完计划（四）：UGUI-14：InputField</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-10-23T20:51:53.000Z" title="Created 2024-10-23 20:51:53">2024-10-23</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/NERV/">NERV</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/NERV/Unity/">Unity</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Unity/">Unity</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/C/">C#</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/10/23/2024-10-23-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
输入框 InputField 也是 UGUI 中较为常见的组件，经常被用于设置用户名、密码以及聊天框等。由于需要处理各种输入情况，因此 InputField 的代码量巨大，足足达到了 3000 行。这其中的大部分代码都用于处理输入时的细节，如对不同类型输入的限制、光标的显示、拖拽选中区域等。作为研究 UGUI 机制的系列文章，我们大可不必深入研究这些细节，只需要了解 InputField 对于不同的事件是如何处理的即可。

InputField 的属性

InputField 有非常多的可配置属性，对上述各属性的解释如下：


Text Component ：文本组件，也就是显示输入所用到的 Text 组件


Text ：文本内容


Character Limit ：字符长度限制


Content Type ：内容类型（数字、邮箱、字母、密码共十种类型选择）

Standard：标准，允许所有字符
Autocorrected：自动纠正，允许所有字符，但会自动纠正（针对某些平台）
Integer Number：整数，只允许输入数字
Decimal Number：小数，只允许输 ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/10/17/2024-10-17-1/" title="Unity 补完计划（四）：UGUI-13：Toggle &amp; ToggleGroup &amp; Slider"><img class="post-bg" src="https://s2.loli.net/2024/07/14/2wNJafA1kFbesZy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity 补完计划（四）：UGUI-13：Toggle &amp; ToggleGroup &amp; Slider"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/17/2024-10-17-1/" title="Unity 补完计划（四）：UGUI-13：Toggle &amp; ToggleGroup &amp; Slider">Unity 补完计划（四）：UGUI-13：Toggle &amp; ToggleGroup &amp; Slider</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-10-17T13:37:18.000Z" title="Created 2024-10-17 13:37:18">2024-10-17</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Unity/">Unity</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Unity/UGUI/">UGUI</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Unity/">Unity</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/C/">C#</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/10/17/2024-10-17-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言

  
  

Toggle （开关）与 ToggleGroup （开关组）经常被用于 UI 界面的各种选项操作中，前者多用于开启或关闭某项功能，而后者则用于从多个选项中选择一项。而 Slider （滑动条）则多用于连续的数值调节中。
本文将分析这些组件的实现。
Toggle
事件的触发
与 Button 类似，Toggle 也支持在点击时触发事件，但开关具有两个状态，因此 Toggle 绑定的也是 UnityEvent&lt;bool&gt; 类型的事件。
123public class ToggleEvent : UnityEvent&lt;bool&gt; &#123;&#125;public ToggleEvent onValueChanged = new ToggleEvent();
在 Set() 函数中，会根据开关的状态以及配置来触发事件。此外，Set() 中还调用了 PlayEffect() 函数，用于设置 CheckMark 的显示。
1234567891011121314151617181920212223void Set(bool value, bool s ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/10/15/2024-10-15-2/" title="Unity 补完计划（四）：UGUI-12：Selectable &amp; Button"><img class="post-bg" src="https://s2.loli.net/2024/07/14/2wNJafA1kFbesZy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity 补完计划（四）：UGUI-12：Selectable &amp; Button"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/15/2024-10-15-2/" title="Unity 补完计划（四）：UGUI-12：Selectable &amp; Button">Unity 补完计划（四）：UGUI-12：Selectable &amp; Button</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-10-15T14:50:21.000Z" title="Created 2024-10-15 14:50:21">2024-10-15</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Unity/">Unity</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Unity/UGUI/">UGUI</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Unity/">Unity</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/C/">C#</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/10/15/2024-10-15-2/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
经过前面数篇文章的分析，现在我们已经对 UGUI 的布局以及渲染过程有了一定的了解，也分析了 Image 以及 Text 等显示类组件的实现。但 UI 元素除了排版与显示外，最重要的功能便是交互了。我们在 EventSystem 中介绍了 UGUI 接受以及处理事件的流程。那么，具体的 UI 元素又该如何接收事件以及按照各自的逻辑处理呢？
这个故事还得从 Selectable 说起。
Selectable
Selectable 是 UGUI 中所有可交互元素的基类，实现了包括 IMoveHandler、IPointerXXXHandler、ISelectHandler 等接口，用于处理各种基本的交互事件。以此派生出的 UI 组件只需要再实现自己独特的 Handle 接口即可。
Selectable 的成员变量
为了维护可选中物体的状态以及交互逻辑，UGUI 定义了一些结构体以及枚举类，这些数据都会在 Selectable 的逻辑处理中用到。
1234567891011121314private Navigation m_Navigation = Navigation.defaul ...</div></div></div><div class="recent-post-item"><div class="post_cover right"><a href="/2024/10/15/2024-10-15-1/" title="Unity 补完计划（四）：UGUI-11：Text"><img class="post-bg" src="https://s2.loli.net/2024/07/14/2wNJafA1kFbesZy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity 补完计划（四）：UGUI-11：Text"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/15/2024-10-15-1/" title="Unity 补完计划（四）：UGUI-11：Text">Unity 补完计划（四）：UGUI-11：Text</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-10-15T12:39:09.000Z" title="Created 2024-10-15 12:39:09">2024-10-15</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Unity/">Unity</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Unity/UGUI/">UGUI</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Unity/">Unity</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/C/">C#</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/10/15/2024-10-15-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
Text 是 UGUI 中最常用的组件之一了，用于显示文本。无论是 UI 界面还是对话框，都会用到 Text。

可以看到，UGUI 渲染文字的方式与图片类似，一个基本的字符也是由四个顶点及分割出的两个三角形组成的。
与 Image 类似，Text 也继承自 MaskableGraphic，并且实现了 ILayoutElement 接口。虽然显示文字的功能非常复杂，但 Text 本身却并不涉及到底层的处理，而是把功能全都交给了一个名为 TextGenerator 的类，因此 Text 的代码量并不大。
Text 的属性
123[SerializeField] private FontData m_FontData = FontData.defaultFontData;[TextArea(3, 10)][SerializeField] protected string m_Text = String.Empty;
m_FontData 是一个 FontData 类型的变量，用于存储字体的属性，Text 中的大部分属性都是根据 m_FontData 来设置的。m_Text 是一个字符 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/10/14/2024-10-14-1/" title="Unity 补完计划（四）：UGUI-10：Image &amp; RawImage"><img class="post-bg" src="https://s2.loli.net/2024/07/14/2wNJafA1kFbesZy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Unity 补完计划（四）：UGUI-10：Image &amp; RawImage"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/10/14/2024-10-14-1/" title="Unity 补完计划（四）：UGUI-10：Image &amp; RawImage">Unity 补完计划（四）：UGUI-10：Image &amp; RawImage</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-10-14T13:21:13.000Z" title="Created 2024-10-14 13:21:13">2024-10-14</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-01-14T10:20:41.000Z" title="Updated 2025-01-14 10:20:41">2025-01-14</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Unity/">Unity</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Unity/UGUI/">UGUI</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/Unity/">Unity</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/tags/C/">C#</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a class="twikoo-count" href="/2024/10/14/2024-10-14-1/#post-comment"><i class="fa-solid fa-spinner fa-spin"></i></a><span class="article-meta-label"> comments</span></span></div><div class="content">前言
将 MaskableGraphic 分析完之后，就可以来看 UGUI 中真正使用到的图像组件了。Image 和 RawImage 是 UGUI 中最常用的两个图像组件，它们分别用于显示 Sprite 和 Texture。本文将分析这两个组件的实现。
Sprite 与 Texture
在 UGUI 中，Sprite 和 Texture 是两个最常用的图像资源。Sprite 是 Unity 引擎中专门用于 2D 图像的资源，它包含了图像的像素数据、UV 坐标、边界信息等。Texture 是 Unity 引擎中用于存储图像像素数据的资源，它可以被 Sprite 使用，也可以被 RawImage 使用。
Unity 的官方手册中，这样描述 Sprite ：


Sprite 是一种 2D 图形对象，用于 2D 游戏中的角色、道具、飞弹和其他游戏元素。图形是从位图图像 Texture2D 获取的。Sprite 类主要标识应该用于特定精灵的图像部分。然后，GameObject 上的 SpriteRenderer 组件可以使用该信息来实际显示图形。


Sprite 是 2D 图形对象。如果习 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/#content-inner">9</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2023/08/12/NkcT1PLmZVj5iY3.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Qliphoth</div><div class="author-info__description">See You Next Game</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">131</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">22</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/qlipphoth"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/qlipphoth" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://space.bilibili.com/33030427" target="_blank" title="Bilibili"><i class="fab fa-bilibili" style="color: #FB7299;"></i></a><a class="social-icon" href="mailto:1841362281@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/12/10/2024-12-10-1/" title="TortoiseSVN 简单入门"><img src="https://s2.loli.net/2023/08/14/mkTFOD8fJbu4VH3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TortoiseSVN 简单入门"/></a><div class="content"><a class="title" href="/2024/12/10/2024-12-10-1/" title="TortoiseSVN 简单入门">TortoiseSVN 简单入门</a><time datetime="2024-12-10T17:21:06.000Z" title="Created 2024-12-10 17:21:06">2024-12-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/23/2024-11-23-1/" title="Lua 源码解析（二）：基本数据类型 —— 表（下）"><img src="https://s2.loli.net/2024/11/08/NRtroieCAd98Uzp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lua 源码解析（二）：基本数据类型 —— 表（下）"/></a><div class="content"><a class="title" href="/2024/11/23/2024-11-23-1/" title="Lua 源码解析（二）：基本数据类型 —— 表（下）">Lua 源码解析（二）：基本数据类型 —— 表（下）</a><time datetime="2024-11-23T16:58:19.000Z" title="Created 2024-11-23 16:58:19">2024-11-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/17/2024-11-17-1/" title="Lua 源码解析（二）：基本数据类型 —— 表（上）"><img src="https://s2.loli.net/2024/11/08/NRtroieCAd98Uzp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lua 源码解析（二）：基本数据类型 —— 表（上）"/></a><div class="content"><a class="title" href="/2024/11/17/2024-11-17-1/" title="Lua 源码解析（二）：基本数据类型 —— 表（上）">Lua 源码解析（二）：基本数据类型 —— 表（上）</a><time datetime="2024-11-17T16:36:15.000Z" title="Created 2024-11-17 16:36:15">2024-11-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/15/2024-11-15-1/" title="Lua 源码解析（二）：基本数据类型 —— 字符串"><img src="https://s2.loli.net/2024/11/08/NRtroieCAd98Uzp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lua 源码解析（二）：基本数据类型 —— 字符串"/></a><div class="content"><a class="title" href="/2024/11/15/2024-11-15-1/" title="Lua 源码解析（二）：基本数据类型 —— 字符串">Lua 源码解析（二）：基本数据类型 —— 字符串</a><time datetime="2024-11-15T16:09:05.000Z" title="Created 2024-11-15 16:09:05">2024-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/14/2024-11-14-1/" title="Lua 源码解析（二）：基本数据类型 —— Lua 中的数据类型"><img src="https://s2.loli.net/2024/11/08/NRtroieCAd98Uzp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Lua 源码解析（二）：基本数据类型 —— Lua 中的数据类型"/></a><div class="content"><a class="title" href="/2024/11/14/2024-11-14-1/" title="Lua 源码解析（二）：基本数据类型 —— Lua 中的数据类型">Lua 源码解析（二）：基本数据类型 —— Lua 中的数据类型</a><time datetime="2024-11-14T15:28:37.000Z" title="Created 2024-11-14 15:28:37">2024-11-14</time></div></div></div></div><div class="card-widget" id="card-newest-comments"><div class="item-headline"><i class="fas fa-comment-dots"></i><span>Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            <a class="card-more-btn" href="/categories/" title="More">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Blog/"><span class="card-category-list-name">Blog</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/CSharp/"><span class="card-category-list-name">CSharp</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Cpp/"><span class="card-category-list-name">Cpp</span><span class="card-category-list-count">48</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Cpp/NERV/"><span class="card-category-list-name">NERV</span><span class="card-category-list-count">7</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Cpp/STL/"><span class="card-category-list-name">STL</span><span class="card-category-list-count">41</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Lua/"><span class="card-category-list-name">Lua</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/MISC/"><span class="card-category-list-name">MISC</span><span class="card-category-list-count">5</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/MISC/DL/"><span class="card-category-list-name">DL</span><span class="card-category-list-count">4</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/Cpp/" style="font-size: 1.45em; color: rgb(19, 147, 188)">Cpp</a><a href="/tags/STL/" style="font-size: 1.42em; color: rgb(28, 130, 126)">STL</a><a href="/tags/UE/" style="font-size: 1.39em; color: rgb(106, 59, 54)">UE</a><a href="/tags/LeetCode/" style="font-size: 1.15em; color: rgb(139, 86, 6)">LeetCode</a><a href="/tags/GAS/" style="font-size: 1.24em; color: rgb(112, 13, 77)">GAS</a><a href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" style="font-size: 1.3em; color: rgb(92, 11, 61)">图形学</a><a href="/tags/MISC/" style="font-size: 1.24em; color: rgb(163, 184, 89)">MISC</a><a href="/tags/DL/" style="font-size: 1.24em; color: rgb(186, 53, 146)">DL</a><a href="/tags/Blog/" style="font-size: 1.18em; color: rgb(150, 135, 57)">Blog</a><a href="/tags/Hexo/" style="font-size: 1.18em; color: rgb(85, 183, 134)">Hexo</a><a href="/tags/Butterfly/" style="font-size: 1.18em; color: rgb(141, 101, 196)">Butterfly</a><a href="/tags/Github-Page/" style="font-size: 1.15em; color: rgb(142, 12, 20)">Github-Page</a><a href="/tags/Github-Action/" style="font-size: 1.15em; color: rgb(98, 110, 1)">Github-Action</a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.15em; color: rgb(133, 9, 18)">数据结构</a><a href="/tags/%E6%A0%91/" style="font-size: 1.15em; color: rgb(129, 26, 129)">树</a><a href="/tags/Unity/" style="font-size: 1.36em; color: rgb(91, 39, 131)">Unity</a><a href="/tags/C/" style="font-size: 1.33em; color: rgb(166, 31, 8)">C#</a><a href="/tags/Lua/" style="font-size: 1.27em; color: rgb(124, 124, 48)">Lua</a><a href="/tags/UGUI/" style="font-size: 1.18em; color: rgb(116, 130, 165)">UGUI</a><a href="/tags/GameDev/" style="font-size: 1.15em; color: rgb(156, 62, 73)">GameDev</a><a href="/tags/%E6%B8%B8%E6%88%8F%E6%9D%82%E8%B0%88/" style="font-size: 1.15em; color: rgb(87, 49, 47)">游戏杂谈</a><a href="/tags/CSharp/" style="font-size: 1.21em; color: rgb(130, 56, 159)">CSharp</a><a href="/tags/OS/" style="font-size: 1.27em; color: rgb(0, 106, 199)">OS</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">December 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">November 2024</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">October 2024</span><span class="card-archive-list-count">8</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">September 2024</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">August 2024</span><span class="card-archive-list-count">9</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">July 2024</span><span class="card-archive-list-count">9</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">April 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">March 2024</span><span class="card-archive-list-count">9</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">131</div></div><div class="webinfo-item"><div class="item-name">Run time :</div><div class="item-count" id="runtimeshow" data-publishDate="2022-08-30T00:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Total Count :</div><div class="item-count">472k</div></div><div class="webinfo-item"><div class="item-name">UV :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">PV :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2025-01-14T10:21:42.099Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s2.loli.net/2023/08/14/GmrqfMSTWaYE7t1.png')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2025 By Qliphoth</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => { 
  const getCommentUrl = () => {
    const eleGroup = document.querySelectorAll('#recent-posts .article-title')
    let urlArray = []
    eleGroup.forEach(i=>{
      urlArray.push(i.getAttribute('href'))
    })
    return urlArray
  }

  const getCount = () => {
    const runTwikoo = () => {
      twikoo.getCommentsCount({
        envId: 'https://qliphoth.netlify.app/.netlify/functions/twikoo',
        region: '',
        urls: getCommentUrl(),
        includeReply: false
      }).then(function (res) {
        document.querySelectorAll('#recent-posts .twikoo-count').forEach((item,index) => {
          item.textContent = res[index].count
        })
      }).catch(function (err) {
        console.log(err)
      })
    }

      if (typeof twikoo === 'object') {
        runTwikoo()
      } else {
        getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
      }
  }

  window.pjax ? getCount() : window.addEventListener('load', getCount)

})()</script><script>window.typedJSFn = {
  init: (str) => {
    window.typed = new Typed('#subtitle', Object.assign({
      strings: str,
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50,
    }, null))
  },
  run: (subtitleType) => {
    if (true) {
      if (typeof Typed === 'function') {
        subtitleType()
      } else {
        getScript('https://cdn.jsdelivr.net/npm/typed.js/dist/typed.umd.min.js').then(subtitleType)
      }
    } else {
      subtitleType()
    }
  }
}
</script><script>function subtitleType () {
  getScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js').then(() => {
    jinrishici.load(result =>{
      if (true) {
        const sub = ["If you want it, then you have to take it."]
        const content = result.data.content
        sub.unshift(content)
        typedJSFn.init(sub)
      } else {
        document.getElementById('subtitle').textContent = result.data.content
      }
    })
  })
}
typedJSFn.run(subtitleType)
</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[link]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[code]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://qliphoth.netlify.app/.netlify/functions/twikoo',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "Unable to get the data, please make sure the settings are correct."
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'No Comment'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="8654234284" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://hexo-api-khaki.vercel.app/api/?user=qlipphoth";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="qlipphoth";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar");
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><script data-pjax>function electric_clock_injector_config(){
                var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
                var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img id="card-clock-loading" src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading" class="entered loading"></div></div></div></div></div>';
                console.log('已挂载electric_clock')
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementsByClassName('sticky_layout')[0] && (location.pathname ==='/'|| '/' ==='all')){

            electric_clock_injector_config()
        } </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax  src="https://cdn.jsdelivr.net/gh/Zfour/hexo-electric-clock@1.0.6/clock.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><div id="ghbdages" style="overflow:hidden;max-height:90px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v5.4.0"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v3.8.2"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/runtime.js"></script><script defer src="https://unpkg.zhimg.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js"></script><!-- hexo injector body_end end --></body></html>